<!doctype html>
<html>
 <head>
  <meta charset=utf-8 />
  <meta name=author value=m93a />
  <title>Multiplayer Test</title>
  <script src=lib/peer.min.js></script>
  <script>
    window.addEventListener("load",function(){
      
      function namegen(){
        
        var name = [
          "Joe",
          "Foo",
          "XXX_Iluminati_XXX",
          "Noscoper",
          "YoMama",
          "TheMe",
          "Aye",
          "DuckDuck",
          "NeedMoreMana",
          "UWotM8",
          "Shaddap"
        ];
        
        name = name[ (Math.random()*name.length)|0 ];
        
        name += "_"+( Math.random()*50 |0 );
        
        return name;
        
      }
      
      var peer = new Peer(
        namegen(),
        {key: 'fvz95i90vzp5vcxr'}
      );
      var conn;
      
      peer.on('open',function(id){
        
        document.body.textContent += "My ID is: "+id;
        var input = document.createElement("input");
        input.placeholder = "Connect to ID";
        input.addEventListener('change',function(){
          conn = peer.connect(input.value);
          conn.on('open',connected);
        });
        document.body.appendChild(input);
        
      });
      
      peer.on('connection',function(c){
        document.body.textContent += ' foo';
        conn = c;
        hearthbeat();
        connected();
      });
      
      peer.on('error',function(foo){
        console.log("Error, "+foo);
      });
      
      function connected(){
        document.body.textContent = "connected to "+conn.id;
        window.peer = peer;
        window.conn = conn;
        conn.on("data",function(e){
          document.body.textContent += " msg!";
          hearthbeat();
        });
      };
      
      var then;
      
      function hearthbeat(){
        
        document.body.textContent += 'bar';
        conn.send('Â¡Hola!');
        
        if(then){
          doucment.body.textContent +=
            " ping: "+(Date.now()-then)+"ms";
          return;
        }
        
        then = Date.now();
        
      };
      
    });
  </script>
 </head>
 <body>
  
 </body>
</html>
