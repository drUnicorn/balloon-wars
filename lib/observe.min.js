/* Copyright (c) 2014 Massimo Artizzu (MaxArt2501), The MIT License */
Object.observe||function(d,C,w){var k,q,H="add update delete reconfigure setPrototype preventExtensions".split(" "),I=w.Node?function(b){return b&&b instanceof w.Node}:function(b){return b&&"object"===typeof b&&"number"===typeof b.nodeType&&"string"===typeof b.nodeName},J=C.isArray||function(b){return function(c){return"[object Array]"===b.call(c)}}(d.prototype.toString),t=C.prototype.indexOf?function(b,c,a){return c.indexOf(b,a)}:function(b,c,a){for(a=a||0;a<c.length;a++)if(c[a]===b)return a;return-1},
x="undefined"!==typeof w.Map&&Map.prototype.forEach?function(){return new Map}:function(){var b=[],c=[];return{size:0,has:function(a){return-1<t(a,b)},get:function(a){return c[t(a,b)]},set:function(a,e){var f=t(a,b);-1===f?(b.push(a),c.push(e),this.size++):c[f]=e},"delete":function(a){a=t(a,b);-1<a&&(b.splice(a,1),c.splice(a,1),this.size--)},forEach:function(a,e){for(var f=0;f<b.length;f++)a.call(e,c[f],b[f],this)}}},D=d.keys||function(b){var c=[],a;for(a in b)b.hasOwnProperty(a)&&c.push(a);return c},
y=d.getPrototypeOf||null,v=d.defineProperties?d.getOwnPropertyDescriptor:null,A=w.requestAnimationFrame||w.webkitRequestAnimationFrame||function(){var b=+new Date;return function(c){return setTimeout(function(){c(+new Date-b)},17)}}(),z=function(){var b=v?function(a,b,f,c,h){var g=b.properties[f],d=a[g],p=b.values[f],m=b.descriptors[f];"value"in h&&(p===d?0===p&&1/p!==1/d:p===p||d===d)&&(r(a,b,{name:g,type:"update",object:a,oldValue:p},c),b.values[f]=d);!m.configurable||h.configurable&&h.writable===
m.writable&&h.enumerable===m.enumerable&&h.get===m.get&&h.set===m.set||(r(a,b,{name:g,type:"reconfigure",object:a,oldValue:p},c),b.descriptors[f]=h)}:function(a,b,f,c){var h=b.properties[f],g=a[h],d=b.values[f];if(d===g?0===d&&1/d!==1/g:d===d||g===g)r(a,b,{name:h,type:"update",object:a,oldValue:d},c),b.values[f]=g},c=v?function(a,e,f,c,d){for(var g=e.length,k;f&&g--;)null!==e[g]&&(k=v(a,e[g]),f--,k?b(a,c,g,d,k):(r(a,c,{name:e[g],type:"delete",object:a,oldValue:c.values[g]},d),c.properties.splice(g,
1),c.values.splice(g,1),c.descriptors.splice(g,1)))}:function(a,b,c,d,h){for(var g=b.length;c&&g--;)null!==b[g]&&(r(a,d,{name:b[g],type:"delete",object:a,oldValue:d.values[g]},h),d.properties.splice(g,1),d.values.splice(g,1),c--)};return function(a,e,f){if(a.handlers.size&&!a.frozen){var l,h,g,k=a.values,p=a.descriptors,m=0,u,n,q;if(a.extensible)if(l=a.properties.slice(),h=l.length,g=D(e),p){for(;m<g.length;)n=g[m++],u=t(n,l),q=v(e,n),-1===u?(r(e,a,{name:n,type:"add",object:e},f),a.properties.push(n),
k.push(e[n]),p.push(q)):(l[u]=null,h--,b(e,a,u,f,q));c(e,l,h,a,f);d.isExtensible(e)||(a.extensible=!1,r(e,a,{type:"preventExtensions",object:e},f),a.frozen=d.isFrozen(e))}else{for(;m<g.length;)n=g[m++],u=t(n,l),p=e[n],-1===u?(r(e,a,{name:n,type:"add",object:e},f),a.properties.push(n),k.push(p)):(l[u]=null,h--,b(e,a,u,f));c(e,l,h,a,f)}else if(!a.frozen){for(;m<l.length;m++)n=l[m],b(e,a,m,f,v(e,n));d.isFrozen(e)&&(a.frozen=!0)}y&&(f=y(e),f!==a.proto&&(r(e,a,{type:"setPrototype",name:"__proto__",object:e,
oldValue:a.proto}),a.proto=f))}}}(),E=function(){k.size&&(k.forEach(z),q.forEach(B),A(E))},B=function(b,c){b.changeRecords.length&&(c(b.changeRecords),b.changeRecords=[])},F=function(b,c){2>arguments.length&&(c=k.get(b));return c&&c.notifier||{notify:function(a){a.type;var e=k.get(b);if(e){var c={object:b},d;for(d in a)"object"!==d&&(c[d]=a[d]);r(b,e,c)}},performChange:function(a,c,f){if("string"!==typeof a)throw new TypeError("Invalid non-string changeType");if("function"!==typeof c)throw new TypeError("Cannot perform non-function");
var d=k.get(b),h;c=c.call(f);d&&z(d,b,a);if(d&&c&&"object"===typeof c){a={object:b,type:a};for(h in c)"object"!==h&&"type"!==h&&(a[h]=c[h]);r(b,d,a)}}}},G=function(b,c,a,e){var d=q.get(a);d||q.set(a,d={observed:x(),changeRecords:[]});d.observed.set(b,{acceptList:e.slice(),data:c});c.handlers.set(a,d)},r=function(b,c,a,d){c.handlers.forEach(function(c){var l=c.observed.get(b).acceptList;("string"!==typeof d||-1===t(d,l))&&-1<t(a.type,l)&&c.changeRecords.push(a)})};k=x();q=x();d.observe=function(b,
c,a){if(null===b||"object"!==typeof b)throw new TypeError("Object.observe cannot observe non-object");if("function"!==typeof c)throw new TypeError("Object.observe cannot deliver to non-function");if(d.isFrozen&&d.isFrozen(c))throw new TypeError("Object.observe cannot deliver to a frozen function object");J(a)||(a=H);var e=k.get(b);if(e)G(b,e,c,a);else{var e=void 0,f=I(b)?[]:D(b),l=[],h,g=0,e={handlers:x(),frozen:d.isFrozen?d.isFrozen(b):!1,extensible:d.isExtensible?d.isExtensible(b):!0,proto:y&&y(b),
properties:f,values:l,notifier:F(b,e)};if(v)for(h=e.descriptors=[];g<f.length;)h[g]=v(b,f[g]),l[g]=b[f[g++]];else for(;g<f.length;)l[g]=b[f[g++]];k.set(b,e);G(b,e,c,a);1===k.size&&A(E)}return b};d.unobserve=function(b,c){if(null===b||"object"!==typeof b)throw new TypeError("Object.unobserve cannot unobserve non-object");if("function"!==typeof c)throw new TypeError("Object.unobserve cannot deliver to non-function");var a=q.get(c),d;if(a&&(d=a.observed.get(b))){a.observed.forEach(function(a,b){z(a.data,
b)});A(function(){B(a,c)});if(1===a.observed.size&&a.observed.has(b))q["delete"](c);else a.observed["delete"](b);if(1===d.data.handlers.size)k["delete"](b);else d.data.handlers["delete"](c)}return b};d.getNotifier=function(b){if(null===b||"object"!==typeof b)throw new TypeError("Object.getNotifier cannot getNotifier non-object");return d.isFrozen&&d.isFrozen(b)?null:F(b)};d.deliverChangeRecords=function(b){if("function"!==typeof b)throw new TypeError("Object.deliverChangeRecords cannot deliver to non-function");
var c=q.get(b);c&&(c.observed.forEach(function(a,b){z(a.data,b)}),B(c,b))}}(Object,Array,this);
